<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Zig - Zellij User Guide</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="installation.html"><strong aria-hidden="true">1.1.</strong> Installation</a></li><li class="chapter-item expanded "><a href="overview.html"><strong aria-hidden="true">1.2.</strong> Overview</a></li><li class="chapter-item expanded "><a href="integration.html"><strong aria-hidden="true">1.3.</strong> Integration</a></li><li class="chapter-item expanded "><a href="faq.html"><strong aria-hidden="true">1.4.</strong> FAQ</a></li></ol></li><li class="chapter-item expanded "><a href="commands.html"><strong aria-hidden="true">2.</strong> Commands</a></li><li class="chapter-item expanded "><a href="configuration.html"><strong aria-hidden="true">3.</strong> Configuration</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="options.html"><strong aria-hidden="true">3.1.</strong> Options</a></li><li class="chapter-item expanded "><a href="keybindings.html"><strong aria-hidden="true">3.2.</strong> Configuring Keybindings</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="keybindings-modes.html"><strong aria-hidden="true">3.2.1.</strong> Modes</a></li><li class="chapter-item expanded "><a href="keybindings-keys.html"><strong aria-hidden="true">3.2.2.</strong> Keys</a></li><li class="chapter-item expanded "><a href="keybindings-examples.html"><strong aria-hidden="true">3.2.3.</strong> Examples</a></li></ol></li><li class="chapter-item expanded "><a href="themes.html"><strong aria-hidden="true">3.3.</strong> Themes</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="theme-gallery.html"><strong aria-hidden="true">3.3.1.</strong> Theme Gallery</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="actions.html"><strong aria-hidden="true">4.</strong> Actions</a></li><li class="chapter-item expanded "><a href="layouts.html"><strong aria-hidden="true">5.</strong> Layouts</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="layouts-templates.html"><strong aria-hidden="true">5.1.</strong> Templates</a></li></ol></li><li class="chapter-item expanded "><a href="plugins.html"><strong aria-hidden="true">6.</strong> Plugins</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="plugin-overview.html"><strong aria-hidden="true">6.1.</strong> Overview</a></li><li class="chapter-item expanded "><a href="plugin-writing.html"><strong aria-hidden="true">6.2.</strong> Developing a Plugin</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="plugin-rust.html"><strong aria-hidden="true">6.2.1.</strong> Rust</a></li><li class="chapter-item expanded "><a href="plugin-zig.html" class="active"><strong aria-hidden="true">6.2.2.</strong> Zig</a></li><li class="chapter-item expanded "><a href="plugin-other.html"><strong aria-hidden="true">6.2.3.</strong> Other Languages</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="compatibility.html"><strong aria-hidden="true">7.</strong> Compatibility</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Zellij User Guide</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="zig"><a class="header" href="#zig">Zig</a></h1>
<h3 id="please-see-the-up-to-date-documentation-for-the-most-recent-features"><a class="header" href="#please-see-the-up-to-date-documentation-for-the-most-recent-features"><strong>Please see the <a href="/documentation">up-to-date documentation</a> for the most recent features.</strong></a></h3>
<p>Writing a zellij plugin in Zig should be just as easy as it is in Rust, thanks to <a href="https://mzte.de/git/LordMZTE/zellzig">zellzig</a>.
This guide should walk you through the basics of using it. <strong>Some basic knowledge of Zig is assumed.</strong></p>
<p>This guide will get you set up with all the tools you need. We'll be using the zellzig example, which is a simple status bar as a starting point.</p>
<h2 id="getting-started"><a class="header" href="#getting-started">Getting Started</a></h2>
<p>First of all, you'll need to install the Zig compiler.
Due to Zig being rather early in development, most of the ecosystem, including zellzig, currently revolves around the master version of the compiler. This means that, to install the compiler, you might have to build it yourself.</p>
<p>If you're on Arch Linux, this should be as simple as installing the <code>zig-git</code> AUR package. On other systems, you should check out Zig's <a href="https://github.com/ziglang/zig/wiki/Building-Zig-From-Source">guide on building the compiler</a>.</p>
<p>Along with zig, you'll also need <a href="https://github.com/mattnite/gyro">gyro</a>. Gyro is a package manager for Zig. It is used by zellzig to manage dependencies.</p>
<h2 id="creating-the-project"><a class="header" href="#creating-the-project">Creating the project</a></h2>
<p>Now that you've got the necessary tooling up and running, we're ready to actually start coding!</p>
<p>First, create a directory for your plugin, cd into it, and initialize zig and gyro:</p>
<pre><code class="language-bash">mkdir zellzig_plugin
cd zellzig_plugin
zig init-lib
gyro init
</code></pre>
<p>Next up, open <code>gyro.zzz</code> and add info about your project and the zellzig dependency:</p>
<pre><code class="language-yaml">pkgs:
  zellzig_plugin:
    version: 0.0.0
    description: &quot;My cool zellzig plugin!&quot;
    license: GPL-3.0 # Your license here
    source_url: &quot;https://git.example.com/your_name/zellzig_plugin&quot;
    root: src/main.zig

deps:
  zellzig:
    git:
      url: &quot;https://mzte.de/git/LordMZTE/zellzig.git&quot;
      ref: master
      root: src/main.zig
</code></pre>
<p>We'll also need to make some changes on the  <code>build.zig</code> build script. Namely,</p>
<ul>
<li>set the target to wasm,</li>
<li>set the system API to wasi,</li>
<li>switch from a static to a shared libary,</li>
<li>and register the gyro dependencies.</li>
</ul>
<p>This is the diff from the default build.zig file:</p>
<pre><code class="language-diff">const std = @import(&quot;std&quot;);
+const pkgs = @import(&quot;deps.zig&quot;).pkgs;

pub fn build(b: *std.build.Builder) void {
    // Standard release options allow the person running `zig build` to select
    // between Debug, ReleaseSafe, ReleaseFast, and ReleaseSmall.
    const mode = b.standardReleaseOptions();

-   const lib = b.addStaticLibrary(&quot;zellzig_plugin&quot;, &quot;src/main.zig&quot;);
+   const lib = b.addSharedLibrary(&quot;zellzig_plugin&quot;, &quot;src/main.zig&quot;, .{ .unversioned = {} });
    lib.setBuildMode(mode);
+
+   lib.target.cpu_arch = .wasm32;
+   lib.target.os_tag = .wasi;
+
+   pkgs.addAllTo(lib);
+
    lib.install();

    const main_tests = b.addTest(&quot;src/main.zig&quot;);
    main_tests.setBuildMode(mode);

    const test_step = b.step(&quot;test&quot;, &quot;Run library tests&quot;);
    test_step.dependOn(&amp;main_tests.step);
}
</code></pre>
<p>Now, you might be asking where this <code>deps.zig</code> file is. Well, It'll be generated by gyro in a second.</p>
<p>If you're using git, you should also add a <code>.gitignore</code>:</p>
<pre><code class="language-gitignore">zig-cache/
zig-out/
.gyro
gyro.lock
deps.zig
</code></pre>
<p>Last but not least, we'll also add a <a href="./layouts.html">zellij layout file</a> for our plugin. Since we're writing a status bar, we'll create a layout that replaces the default status bar with our bar:</p>
<pre><code class="language-yaml">---
template:
  direction: Horizontal
  parts:
    - direction: Vertical
      borderless: true
      split_size:
        Fixed: 1
      run:
        plugin:
          location: &quot;zellij:tab-bar&quot;
      
    - direction: Vertical
      plugin: &quot;zig-out/lib/example.wasm&quot;
    
    - direction: Vertical
      borderless: true
      split_size:
        Fixed: 1
      run:
        plugin:
          location: &quot;file:zig-out/lib/zellzig_plugin.wasm&quot;
</code></pre>
<h2 id="writing-the-plugin"><a class="header" href="#writing-the-plugin">Writing the plugin</a></h2>
<p>Before we actually get coding, we should check if what we've just created actually is correct. We can test if the default Zig template compiles by running <code>gyro build</code>. This should also download all dependencies.</p>
<p>If everything went well, we should also have the plugin file (which won't work just yet) in <code>zig-out/lib/</code>.</p>
<p>Now that we got all the preparation out the way, we can finally jump in. Let's open <code>src/main.zig</code>!</p>
<p>Zig will have generated some boilerplate in there, but except for the first line, which imports the standard library, we can get rid of everything.</p>
<h3 id="registering-the-plugin"><a class="header" href="#registering-the-plugin">Registering the plugin</a></h3>
<p>We'll now start by importing zellzig, and saving the import in a variable called <code>zz</code>:</p>
<pre><code class="language-zig">const std = @import(&quot;std&quot;);
const zz = @import(&quot;zellzig&quot;);
</code></pre>
<p>This won't do much on its own, but now we can call zellzig functions.
The first one we should call is one that creates all the exported symbols that zellij will call, alongside some communication handling.
This function actually needs to be called at compile time, as all it does is give the compiler some functions to be exported by the wasm file. Because of this, It goes in a <code>comptime</code> block.</p>
<pre><code class="language-zig">const std = @import(&quot;std&quot;);
const zz = @import(&quot;zellzig&quot;);

comptime {
    zz.createPlugin(@This());
}
</code></pre>
<p>We pass in <code>@This()</code>, which is the struct of the current scope.
Since namespaces in zig are just structs, this return our root struct.
<code>createPlugin</code> needs this, so it can get access to the functions we'll define next.</p>
<p>There are 3 functions that zellzig calls:</p>
<ul>
<li>init
<ul>
<li>called on plugin initialization</li>
</ul>
</li>
<li>update
<ul>
<li>called on an event</li>
</ul>
</li>
<li>render
<ul>
<li>called to draw the plugin</li>
</ul>
</li>
</ul>
<h3 id="the-init-function"><a class="header" href="#the-init-function">The <code>init</code> function</a></h3>
<p>In the <code>init</code> function, we should set zellzig's allocator, which it uses for deseralization of zellij's messages.</p>
<pre><code class="language-zig">var gpa = std.heap.GeneralPurposeAllocator(.{}){};

pub fn init() void {
    zz.allocator = gpa.allocator();
}
</code></pre>
<p>Here, we create a <code>GeneralPurposeAllocator</code>. It's assigned to a global variable, so it's not dropped once <code>init</code> returns.
Then, we assign the allocator to <code>zz.allocator</code>. Now the allocator is set.</p>
<p>Next, we'll make sure zellij doesnt stay open because of our plugin. To do this, we'll make our plugin unselectable:</p>
<pre><code class="language-zig">zz.api.setSelectable(false);
</code></pre>
<p>The last thing we'll put in init is a call to <code>subscribe</code>. This tells zellij what events we're interested in:</p>
<pre><code class="language-zig">zz.api.subscribe(&amp;[_]zz.types.EventType{.ModeUpdate}) catch unreachable;
</code></pre>
<p>The <code>subscribe</code> function takes a slice of <code>EventType</code>s we want to receive. Since we're making a status bar, we only care about mode updates, but you can add more if you wish.</p>
<p>This function can return an error, since sending data to zellij might fail. But since we can't recover from it, we'll use <code>catch unreachable</code>, so the program crashes if this fails.</p>
<p>Our code should now look like this:</p>
<pre><code class="language-zig">const std = @import(&quot;std&quot;);
const zz = @import(&quot;zellzig&quot;);

comptime {
    zz.createPlugin(@This());
}

var gpa = std.heap.GeneralPurposeAllocator(.{}){};

pub fn init() void {
    zz.allocator = gpa.allocator();
    zz.api.setSelectable(false);
    zz.api.subscribe(&amp;[_]zz.types.EventType{.ModeUpdate}) catch unreachable;
}
</code></pre>
<h3 id="the-update-function"><a class="header" href="#the-update-function">The <code>update</code> function</a></h3>
<p>This function is responsible for handling the events we've subscribed to. In our case, that's only <code>ModeUpdate</code>s.</p>
<p>First, this is what the function looks like:</p>
<pre><code class="language-zig">pub fn update(ev: zz.Event) void {

}
</code></pre>
<p>As a parameter, it takes an event. Since we've only subscribed to <code>ModeUpdate</code> events, that's the only event we'll get.</p>
<p>Since we want to render the current mode, we need to save it when we receive it in <code>update</code>. Thus, we'll create a global variable that holds the current mode, and assign it in <code>update</code>.</p>
<pre><code class="language-zig">var mode: ?zz.types.InputMode = null;

pub fn update(ev: zz.Event) void {
    switch (ev) {
        .ModeUpdate =&gt; |mode_info| mode = mode_info.mode,
        else =&gt; {},
    }
}
</code></pre>
<p>We also make mode optional, since we don't know it once the plugin is initalized, but we'll get a mode event right away, so it doesn't really matter.</p>
<h3 id="the-render-functio"><a class="header" href="#the-render-functio">The <code>render</code> functio</a></h3>
<p><code>render</code> is the last function we need. In it, we display the current mode (which we saved in <code>mode</code>, remember?).</p>
<pre><code class="language-zig">pub fn render(rows: i32, cols: i32) void {
    _ = rows;
    _ = cols;

    if (mode) |m| {
        var out = std.io.getStdOut();
        var writer = out.writer();
        writer.writeAll(@tagName(m)) catch {};
    }
}
</code></pre>
<p>We assign <code>rows</code> and <code>cols</code> to <code>_</code>, since we don't need them. Next we check if <code>mode</code> is set, and if it is, we print it out.</p>
<p><code>@tagName</code> returns the string name of an enum variable.</p>
<p>With the last function in place, our plugin should be all done. This is what the finished code looks like:</p>
<pre><code class="language-zig">const std = @import(&quot;std&quot;);
const zz = @import(&quot;zellzig&quot;);

comptime {
    zz.createPlugin(@This());
}

var gpa = std.heap.GeneralPurposeAllocator(.{}){};
var mode: ?zz.types.InputMode = null;

pub fn init() void {
    zz.allocator = gpa.allocator();
    zz.api.setSelectable(false);
    zz.api.subscribe(&amp;[_]zz.types.EventType{.ModeUpdate}) catch unreachable;
}

pub fn update(ev: zz.Event) void {
    switch (ev) {
        .ModeUpdate =&gt; |mode_info| mode = mode_info.mode,
        else =&gt; {},
    }
}

pub fn render(rows: i32, cols: i32) void {
    _ = rows;
    _ = cols;

    if (mode) |m| {
        var out = std.io.getStdOut();
        var writer = out.writer();
        writer.writeAll(@tagName(m)) catch {};
    }
}
</code></pre>
<p>Now, all that's left is to build with <code>gyro build -Drelease-fast</code> (you should do a release build, since debug builds tend to be buggy sometimes) and run zellij with our layout file: <code>zellij --layout-path plugin.yaml</code>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="plugin-rust.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="plugin-other.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="plugin-rust.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="plugin-other.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
